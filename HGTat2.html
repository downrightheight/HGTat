<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Text Overlay</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            text-align: center; 
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
        }
        .container {
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            max-width: 1400px;
            margin: 20px;
        }
        canvas { 
            border: 1px solid #000; 
            flex: 0 0 auto;
        }
        .debug-controls { 
            margin: 20px; 
            display: none; 
            flex: 0 0 300px;
            text-align: left;
            padding-left: 20px;
        }
        .controls { 
            margin: 20px; 
            width: 100%;
            text-align: center;
        }
        input, button { 
            margin: 5px; 
        }
        .control-group { 
            margin-bottom: 15px; 
            display: flex;
            align-items: center;
        }
        label { 
            display: inline-block; 
            width: 120px; 
            text-align: left; 
        }
        .debug-controls h4 {
            margin-top: 15px;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <h1>Hellgate Meat Tattoo Generator</h1>
    <div class="container">
        <canvas id="canvas" width="1024" height="1024"></canvas>
        
        <div class="debug-controls" id="debugControls">
            <h3>Debug Mode</h3>
            <h4>Image Settings</h4>
            <label>X Offset: <input type="range" id="imageXOffset" min="-512" max="512" value="-512" oninput="updateText()"></label><br>
            <label>Y Offset: <input type="range" id="imageYOffset" min="-512" max="512" value="-512" oninput="updateText()"></label><br>
            
            <h4>Foreword Settings</h4>
            <label>X Position: <input type="range" id="forewordXPos" min="0" max="1024" value="590" oninput="updateText()"></label><br>
            <label>Y Position: <input type="range" id="forewordYPos" min="0" max="1024" value="88" oninput="updateText()"></label><br>
            <label>Font Size: <input type="range" id="forewordFontSize" min="10" max="100" value="25" oninput="updateText()"></label><br>
            
            <h4>MEAT Number Settings</h4>
            <label>X Position: <input type="range" id="meatNumberXPos" min="0" max="1024" value="565" oninput="updateText()"></label><br>
            <label>Y Position: <input type="range" id="meatNumberYPos" min="0" max="1024" value="119" oninput="updateText()"></label><br>
            <label>Font Size: <input type="range" id="meatNumberFontSize" min="10" max="100" value="29" oninput="updateText()"></label><br>
            
            <h4>End Word Settings</h4>
            <label>X Position: <input type="range" id="endWordXPos" min="0" max="1024" value="551" oninput="updateText()"></label><br>
            <label>Y Position: <input type="range" id="endWordYPos" min="0" max="1024" value="140" oninput="updateText()"></label><br>
            <label>Font Size: <input type="range" id="endWordFontSize" min="10" max="100" value="16" oninput="updateText()"></label><br>
            
            <label>Global Opacity: <input type="range" id="globalOpacity" min="0" max="1" step="0.1" value="0.7" oninput="updateText()"></label><br>
            <p>Current Settings: <code id="settingsOutput"></code></p>
        </div>
    </div>
    
    <div class="controls">
        <div class="control-group">
            <label>Foreword:</label>
            <input type="text" id="forewordInput" placeholder="Enter foreword" value="PRE">
        </div>
        <div class="control-group">
            <label>MEAT Number:</label>
            <input type="text" id="meatNumberInput" placeholder="Enter MEAT number" value="X1000">
        </div>
        <div class="control-group">
            <label>End Word:</label>
            <input type="text" id="endWordInput" placeholder="Enter end word" value="POST">
        </div>
        <button onclick="overlayText()">Overlay Text</button>
        <button onclick="downloadImage()">Download Image</button>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let image = new Image();
        let textSettings = {
            image: { xOffset: -512, yOffset: -512 }, // Default: image centered on 1024x1024 canvas
            foreword: { x: 590, y: 88, fontSize: 25, color: '#000000', text: 'PRE' },
            meatNumber: { x: 565, y: 119, fontSize: 29, color: '#000000', text: 'X1000' },
            endWord: { x: 551, y: 140, fontSize: 16, color: '#000000', text: 'POST' },
            globalOpacity: 0.7
        };
        const defaultMeatNumber = { x: 565, y: 119 }; // Default MEAT Number position for offset calculation

        // Check for debug mode in URL
        const urlParams = new URLSearchParams(window.location.search);
        const isDebug = urlParams.get('debug') === 'true';
        if (isDebug) {
            document.getElementById('debugControls').style.display = 'block';
            document.getElementById('imageXOffset').value = textSettings.image.xOffset;
            document.getElementById('imageYOffset').value = textSettings.image.yOffset;
            document.getElementById('forewordXPos').value = textSettings.foreword.x;
            document.getElementById('forewordYPos').value = textSettings.foreword.y;
            document.getElementById('forewordFontSize').value = textSettings.foreword.fontSize;
            document.getElementById('meatNumberXPos').value = textSettings.meatNumber.x;
            document.getElementById('meatNumberYPos').value = textSettings.meatNumber.y;
            document.getElementById('meatNumberFontSize').value = textSettings.meatNumber.fontSize;
            document.getElementById('endWordXPos').value = textSettings.endWord.x;
            document.getElementById('endWordYPos').value = textSettings.endWord.y;
            document.getElementById('endWordFontSize').value = textSettings.endWord.fontSize;
            document.getElementById('globalOpacity').value = textSettings.globalOpacity;
        }

        // Load the fixed template image
        image.src = 'template.png';
        image.onload = () => {
            if (image.width === 1024 && image.height === 1024) {
                drawCanvas();
            } else {
                alert('Template image must be 1024x1024 pixels.');
            }
        };
        image.onerror = () => {
            alert('Failed to load template image. Ensure template.png exists on the server.');
        };

        function drawCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.globalAlpha = textSettings.globalOpacity;
            // Draw image with X and Y offsets
            ctx.drawImage(image, textSettings.image.xOffset, textSettings.image.yOffset);
            
            // Draw Foreword (centered)
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.font = `${textSettings.foreword.fontSize}px Gunplay`;
            ctx.fillStyle = textSettings.foreword.color;
            ctx.fillText(textSettings.foreword.text, textSettings.foreword.x, textSettings.foreword.y);
            
            // Draw MEAT Number (left-aligned, as original)
            ctx.textAlign = 'left';
            ctx.textBaseline = 'top';
            ctx.font = `${textSettings.meatNumber.fontSize}px Gunplay`;
            ctx.fillStyle = textSettings.meatNumber.color;
            ctx.fillText(textSettings.meatNumber.text, textSettings.meatNumber.x, textSettings.meatNumber.y);
            
            // Draw End Word (centered)
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.font = `${textSettings.endWord.fontSize}px Gunplay`;
            ctx.fillStyle = textSettings.endWord.color;
            ctx.fillText(textSettings.endWord.text, textSettings.endWord.x, textSettings.endWord.y);
            
            ctx.globalAlpha = 1.0;
        }

        function overlayText() {
            textSettings.foreword.text = document.getElementById('forewordInput').value || 'PRE';
            textSettings.meatNumber.text = document.getElementById('meatNumberInput').value || 'X1000';
            textSettings.endWord.text = document.getElementById('endWordInput').value || 'POST';
            textSettings.foreword.color = '#000000';
            textSettings.meatNumber.color = '#000000';
            textSettings.endWord.color = '#000000';
            drawCanvas();
        }

        function updateText() {
            if (isDebug) {
                // Update MEAT Number position
                textSettings.meatNumber.x = parseInt(document.getElementById('meatNumberXPos').value);
                textSettings.meatNumber.y = parseInt(document.getElementById('meatNumberYPos').value);
                
                // Calculate image offset based on MEAT Number's deviation from default
                const deltaX = textSettings.meatNumber.x - defaultMeatNumber.x;
                const deltaY = textSettings.meatNumber.y - defaultMeatNumber.y;
                textSettings.image.xOffset = -512 + deltaX; // Center (512,512) plus MEAT Number offset
                textSettings.image.yOffset = -512 + deltaY;
                
                // Update image offset sliders to reflect synchronized values
                document.getElementById('imageXOffset').value = textSettings.image.xOffset;
                document.getElementById('imageYOffset').value = textSettings.image.yOffset;

                // Update other settings
                textSettings.image.xOffset = parseInt(document.getElementById('imageXOffset').value);
